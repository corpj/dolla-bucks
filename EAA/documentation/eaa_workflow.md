# EAA Payment Processing Workflow Documentation

## Overview

The EAA (Employee Assistance Association) payment processing system is designed to handle payments from EAA by importing data from Word documents, mapping customers based on SSN matching, and inserting the processed payments into the payments_az table. The workflow is implemented through a menu-driven interface that guides users through each step of the process.

## Database Tables

The system uses the following key database tables:

1. **eaa_payments**: Stores the imported EAA payment data, including:
   - id
   - ssn
   - first_name
   - last_name
   - amount
   - payment_date
   - clientID (mapped customer ID)
   - payment_id (unique payment identifier)
   - notes
   - status

2. **customers**: The internal customer database:
   - CustomerID
   - PrimaryClientID
   - FirstName
   - LastName
   - SSN
   - EmployerID
   - Other customer details

3. **payments_az**: The destination table for processed payments:
   - clientID (mapped customer ID)
   - payment_type (set to 14 for EAA payments)
   - notes (formatted as "EAA Payment Applied for MM/DD/YYYY")
   - payment_id (unique payment identifier)
   - Other payment details

## Workflow Components

### 1. Data Processing (`eaa_data_processor.py`)

This script extracts payment data from Word documents and converts it to a structured CSV format.

**Key Functions:**
- Parses Word documents containing EAA payment information
- Extracts customer names, SSNs, and payment amounts
- Generates a standardized CSV file for further processing

### 2. Database Import (`eaa_db_importer.py`)

This script imports the processed CSV data into the eaa_payments table.

**Key Functions:**
- Reads the CSV file generated by the data processor
- Inserts records into the eaa_payments table
- Handles data validation and error checking

### 3. Customer Mapping

The system maps customers to payments using SSN matching with employer IDs 160, 199, and 225.

**Key Functions:**
- Automatic mapping based on SSN matches
- Manual mapping for unmatched records
- Updates the clientID field in the eaa_payments table

### 4. Payment Application (`apply_payments.py`)

This script inserts the mapped payments into the payments_az table.

**Key Functions:**
- Retrieves mapped payments from the eaa_payments table
- Formats payment notes and details
- Inserts records into the payments_az table
- Updates the status in the eaa_payments table

### 5. Record Checking (`check_records.py`, `check_all_records.py`)

These scripts verify the status of payment records and identify any issues.

**Key Functions:**
- Checks for unmapped records
- Verifies payment application status
- Generates reports on processing status

## Menu-Driven Workflow

The EAA payments menu (`payments_module_menu.py`) provides a user-friendly interface for the entire workflow:

### 1. Import Payments from Word Document
- Allows the user to select a Word document containing payment data
- Calls the data processor to extract information
- Calls the database importer to load data into the eaa_payments table
- Automatically maps customers based on existing SSN matches
- Moves processed files to the appropriate year folder

### 2. Map Customers to Payments
- Retrieves unmapped records from the eaa_payments table
- Maps customers based on SSN matching with specific employer IDs
- Updates the clientID field for matched records
- Provides statistics on the mapping process

### 3. View Unmatched Records
- Displays records that have not been mapped to customers
- Shows SSN, name, and amount information
- Allows filtering and sorting of records

### 4. View Matched Records
- Displays records that have been successfully mapped
- Shows customer information and payment details
- Allows filtering and sorting of records

### 5. Search for Customer by Name
- Provides a search interface to find customers by name
- Displays matching customers with their details
- Allows selection of a customer for mapping

### 6. Update Customer ID Manually
- Allows manual entry of a clientID for an unmapped record
- Verifies the existence of the customer
- Updates the mapping in the database

### 7. Insert Payments into payments_az Table
- Processes mapped payments and inserts them into the payments_az table
- Sets the payment_type to 14 (EAA payment)
- Formats notes as "EAA Payment Applied for MM/DD/YYYY"
- Updates the status in the eaa_payments table

### 8. View Summary Report
- Displays statistics on the payment processing
- Shows total records, matched records, and inserted payments
- Provides a breakdown of payment amounts

### 9. Exit
- Closes the application

## Process Flow

1. **Data Import**:
   - User selects a Word document containing EAA payment data
   - System extracts data and creates a CSV file
   - Data is imported into the eaa_payments table
   - Auto-mapping is performed based on existing SSN matches

2. **Customer Mapping**:
   - System attempts to map customers based on SSN matching
   - User reviews unmapped records
   - Manual mapping is performed for remaining records

3. **Payment Processing**:
   - Mapped payments are inserted into the payments_az table
   - Payment status is updated in the eaa_payments table

4. **Reporting**:
   - System generates summary reports on the processing
   - User can view statistics and verify completion

## Best Practices

1. **Regular Processing**:
   - Process EAA payments promptly when received
   - Follow the menu steps in sequence for best results

2. **Manual Review**:
   - Always review unmapped records and attempt to map them
   - Use the search functionality to find matching customers

3. **Verification**:
   - Check the summary report to ensure all payments are processed
   - Verify that the total amount matches the expected value

4. **File Management**:
   - Keep original Word documents in the appropriate year folder
   - Maintain CSV files for audit purposes

## Troubleshooting

1. **Import Issues**:
   - Ensure the Word document follows the expected format
   - Check for special characters or formatting that might cause parsing errors

2. **Mapping Problems**:
   - Verify that SSNs are correctly formatted in both systems
   - Check for name discrepancies that might prevent automatic matching

3. **Database Errors**:
   - Ensure database connections are properly configured
   - Check for table structure changes that might affect the process

4. **Payment Application Failures**:
   - Verify that all required fields are populated
   - Check for duplicate payment_id values
